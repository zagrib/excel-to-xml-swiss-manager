<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Swiss Manager PRO XML Tool</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body{font-family:ui-sans-serif;background:#fff;padding:30px;color:#111}
.wrap{max-width:1000px;margin:auto;border:1px solid #e5e7eb;border-radius:12px;padding:20px}
.tabs{display:flex;gap:8px;margin:10px 0}
.tab{padding:6px 12px;border:1px solid #ddd;border-radius:8px;cursor:pointer}
.tab.active{background:#111;color:#fff}
textarea{width:100%;height:420px;border:1px solid #e5e7eb;border-radius:8px;padding:10px;font-family:monospace}
button{background:#111;color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;margin-top:10px}
</style>
</head>

<body>
<div class="wrap">

<h3>Swiss Manager PRO XML Generator</h3>

<input type="file" id="fileInput" accept=".xlsx,.xls">
<button onclick="loadFile()">LOAD FILE</button>

<div class="tabs">
<div class="tab active" onclick="setTab('ALL',this)">ALL</div>
<div class="tab" onclick="setTab('Teams',this)">Teams</div>
<div class="tab" onclick="setTab('Players',this)">Players</div>
<div class="tab" onclick="setTab('TeamCompositions',this)">TeamCompositions</div>
<div class="tab" onclick="setTab('Results',this)">Results</div>
</div>

<button onclick="copyXML()">COPY XML</button>

<textarea id="output"></textarea>

</div>

<script>

let workbookGlobal=null;
let currentTab="ALL";
let lastXML="";

function esc(v){
 if(v===undefined||v===null) return "";
 return String(v)
  .replace(/&/g,"&amp;")
  .replace(/"/g,"&quot;")
  .replace(/</g,"&lt;")
  .replace(/>/g,"&gt;");
}

function rowsFromSheet(sheet){
 const raw=XLSX.utils.sheet_to_json(sheet,{header:1,defval:""});
 let headers=raw[0]||[];

 headers=headers.map(h=>{
   if(h==="Nama") return "Firstname";
   return h;
 });

 const data=XLSX.utils.sheet_to_json(sheet,{defval:""});
 return {headers,data};
}

function buildTag(wb,sheetName,tagName,validator){
 if(!wb.Sheets[sheetName]) return "";

 const {headers,data}=rowsFromSheet(wb.Sheets[sheetName]);

 let xml=`<${sheetName}>\n`;

 data.forEach(r=>{

   if(!validator(r)) return;

   let attr="";
   headers.forEach(h=>{
     if(!h||!r[h]) return;
     attr+=` ${h}="${esc(r[h])}"`;
   });

   xml+=`  <${tagName}${attr}/>\n`;
 });

 xml+=`</${sheetName}>\n`;

 return xml;
}

function buildXML(){

 if(!workbookGlobal){
   document.getElementById("output").value="Belum load file.";
   return;
 }

 let xml='<?xml version="1.0" encoding="UTF-8"?>\n';

 if(currentTab==="ALL"||currentTab==="Teams"){
   xml+=buildTag(workbookGlobal,"Teams","Team",
     r=>r.TeamLongname&&r.TeamUniqueId);
 }

 if(currentTab==="ALL"||currentTab==="Players"){
   xml+=buildTag(workbookGlobal,"Players","Player",
     r=>r.PlayerUniqueId&&r.Firstname);
 }

 if(currentTab==="ALL"||currentTab==="TeamCompositions"){
   xml+=buildTag(workbookGlobal,"TeamCompositions","TeamComposition",
     r=>r.Round&&r.Board&&(r.PlayerUniqueId||r.PlayerId||r.PlayerSNo));
 }

 if(currentTab==="ALL"||currentTab==="Results"){
   xml+=buildTag(workbookGlobal,"Results","Result",
     r=>r.Round&&(r.PlayerWhiteUniqueId||r.PlayerWhiteId||r.PlayerWhiteSNo));
 }

 lastXML=xml;
 document.getElementById("output").value=xml;
}

function loadFile(){

 const file=document.getElementById("fileInput").files[0];
 if(!file){
   alert("Pilih file dulu");
   return;
 }

 const reader=new FileReader();

 reader.onload=function(evt){
   const data=new Uint8Array(evt.target.result);
   workbookGlobal=XLSX.read(data,{type:"array"});
   buildXML();
 };

 reader.readAsArrayBuffer(file);
}

function setTab(tab,el){

 currentTab=tab;

 document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
 el.classList.add("active");

 buildXML();
}

function copyXML(){
 if(!lastXML) return alert("Belum ada XML");
 navigator.clipboard.writeText(lastXML);
}

</script>
</body>
</html>
